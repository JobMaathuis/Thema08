---
title: ""
output:
  html_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r warning=FALSE}
# Load deSolve package
library(deSolve)

# Function with the models differential equations
wildlife_urbanization_model <- function(t, state, paramters) {
  with(as.list(c(state, paramters)),{
    
    dSp <- (b0 - (b1 * (Sp + Ip)) / (1-f)) * (Sp + Ip) - m * Sp -  # demography
      beta_p * Sp * Ip + gamma * Ip -  # infection
      sigma * f * Sp + sigma * (1 - c_sigma) * (1 - f) * St  # movement
    
    
    
    dIp <-  beta_p * Sp * Ip - gamma * Ip -  # infection
      (m + mu) * Ip -  # demography
      sigma * f * Ip + sigma * f * Ip + sigma * (1 - c_sigma) * (1 - f) * It  # movement
    
    
    dSt <- (b0 - (b1 * (St + It) / f)) * (St + It) - (m / (1 - c_m)) * St -  # demography
      beta_t * St * It + gamma * It +  # infection
      sigma * f * Sp - sigma * (1 - c_sigma) * (1 - f) * St  # movement
    
    
    dIt <- beta_t * St * It - gamma * It -  # infection
      ((m + mu) / (1 - alpha * c_m)) * It +  # demography
      sigma * f * Ip - sigma * (1 - c_sigma) * (1 - f) * It  # movement
      
    
      
    list(c(dSp, dIp, dSt, dIt))
  }) 
}

population <- 50000
infected <- 100
df <- data.frame()

for (f in seq(0.01, 0.99, 0.01)){
  # demography
  m <- 0.1
  b0 <- 0.4
  b1 <- (b0 - m) / population
  c_m <- 0.2
  
  # infection
  beta_p <- 0.006
  beta_t <- 0.006
  gamma <- 36.5
  mu <- 0.25
  alpha <- 2
  
  # movement
  sigma <- -log(0.1)
  c_sigma <- 0.2
  
  parameters <- c(m, b0, b1, c_m, beta_p, beta_t, gamma, mu, alpha, f, sigma, c_sigma)
  
  # Initial values
  state<- c(Sp = (population - infected) * (1 - f),
            Ip = infected * (1 - f),
            St = (population - infected) * f,
            It=  infected * f)
  
  # Time frame of 50 years
  times <- seq(0, 50, 0.05)
  
  out <- tail(ode(y = state, times = times, func = wildlife_urbanization_model, parms = parameters), 1)
  df <- rbind(df, c(f, out[2:5], sum(out[2:5])))
}

colnames(df) <- c('f', 'Sp', 'Ip', 'St', 'It', 'N')
plot(df$N ~ df$f, type = 'l')
# plot(out)
```